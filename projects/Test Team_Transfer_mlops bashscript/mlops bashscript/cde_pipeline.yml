steps:
  - name: asia-south1-docker.pkg.dev/ibank-docai-devops/ibci-docai-docker-ar/cloudbuild/pycov/mlops:latest
    args:
      - '-c'
      - >
        pip install -r requirements.txt --extra-index-url
        https://asia-south1-python.pkg.dev/ibank-docai-devops/ibci-docai-python-ar/simple
        && source /app/variables.env &&  pytest tests/unit/src/mlops_pipeline
        --cov=src/mlops_pipeline
    id: Code Coverage
    entrypoint: bash  
  - name: asia-south1-docker.pkg.dev/ibank-docai-devops/ibci-docai-docker-ar/cloudbuild/docker:latest
    args:
      - '-c'
      - >
        docker build --network=cloudbuild -t
        ${_REPOSITORY_URL}/${_IMAGE}:${SHORT_SHA} -f
        ./src/mlops_pipeline/cde_pipeline/components/evaluation/Dockerfile .
    id: Build container image
    entrypoint: /bin/bash
  - name: asia-south1-docker.pkg.dev/ibank-docai-devops/ibci-docai-docker-ar/cloudbuild/docker:latest
    args:
      - '-c'
      - |
        docker tag ${_REPOSITORY_URL}/${_IMAGE}:${SHORT_SHA} ${_REPOSITORY_URL}/${_IMAGE}:latest && docker push ${_REPOSITORY_URL}/${_IMAGE}:${SHORT_SHA}
    id: Tag Container image
    entrypoint: /bin/bash
  - name: asia-south1-docker.pkg.dev/ibank-docai-devops/ibci-docai-docker-ar/cloudbuild/pycov/mlops:latest
    args:
      - '-c'
      - |
        ./pythonbash.sh
    id: spec file genaration
    entrypoint: /bin/bash
timeout: 800s
options:
  workerPool: >-
    projects/ibank-docai-devops/locations/asia-south1/workerPools/ibsi-docai-devops-cb-wp01
  logging: CLOUD_LOGGING_ONLY




docker push  asia-south1-docker.pkg.dev/ibank-docai-devops/ibci-docai-docker-ar/cloudbuild/pycov/mlops:latest
docker build -t  asia-south1-docker.pkg.dev/ibank-docai-devops/ibci-docai-docker-ar/cloudbuild/pycov/mlops:latest .

docker tag asia-south1-docker.pkg.dev/ibank-development/mlops-training-pipeline/custom_od_base_image:latest asia-south1-docker.pkg.dev/ibank-docai-devops/ibci-docai-docker-ar/cloudbuild/custodbase/mlops && docker push asia-south1-docker.pkg.dev/ibank-docai-devops/ibci-docai-docker-ar/cloudbuild/custodbase/mlops:latest



gsutil -m cp -r   "gs://ibank-development-transfer-bucket/Jibin_wheels_v3/wheels"   .

pip install kfp==1.8.12 --extra-index-url https://asia-south1-python.pkg.dev/ibank-docai-devops/ibci-docai-mlopsod-ar/simple 